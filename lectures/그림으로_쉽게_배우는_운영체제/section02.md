## 💻 프로세스와 쓰레드

### 📌 프로그램과 프로세스

**프로그램**: 저장장치에 저장된 명령문의 집합체 (Application, .exe,,,)
**프로세스**: 실행 중인 프로그램. "실행 중"은 하드디스크에 저장된 프로그램이 메모리에 올라갔을 때를 의미한다.

**프로그램**은 저장장치에 저장만 되는 **수동적인** 존재이지만,
**프로세스**는 메모리, CPU 스케줄링 알고리즘, 입/출력도 사용하는 **능동적인** 존재.

#### ✅ 프로세스의 구조
1. **코드 영역**
   - 자신을 실행한는 코드가 저장 
2. **데이터 영역**
    - 스태틱 변수와 전역 변수 저장
3. **스택 영역**
   - 지역 변수와 함수 호출을 위한 정보 저장 
4. **힙 영역**
   - 프로그래머가 동적으로 메모리를 할당
   - `free()`, `malloc()`을 통해 메모리 관리

#### ✅ 컴파일 과정
1. 전처리기를 통해 매크로로 정의한 숫자를 치환하고 필요한 파일을 불러온다.
2. 파일의 확장자(`.i`)
3. 컴파일 (C언어 > 어셈블리어)
4. 파일의 확장자(`.s`)
5. 어셈블리어 > 기계어
6. 파일의 확장자(`.o`) 
7. 링킹을 통해 파일의 확장자(`.exe`)로 변경 

#### ✅ 프로세스 실행 과정
1. 두 숫자를 더하는 코드를 작성
2. 컴파일
3. `.exe` 파일을 실행
4. 메모리에 파일이 올라감 (프로세스)
5. CPU 내 제어장치가 파일을 읽어가며 레지스터 저장 및 연산
6. 결과 메모리 저장

### 📌 멀티프로그래밍과 멀티프로세싱

#### ✅ 유니 프로그래밍
(메모리 관점) 메모리에 오직 하나의 프로세스가 올라온 것
#### ✅ 멀티 프로그래밍
(메모리 관점) 메모리에 여러 개의 프로세스가 올라온 것
#### ✅ 멀티 프로세싱
(CPU 관점) CPU가 여러 개의 프로세스를 처리하는 것

**과거**
**-> 유니 프로그래밍 + 멀티 프로세싱 방식 사용 (**스와핑**)**
1. 메모리에 하나의 프로세스를 올려 처리 한 후, 저장장치에 저장
2. 다른 저장장치의 프로세스를 메모리에 올려 CPU 처리

**현재**
**-> 멀티 프로그래밍 + 멀티 프로세싱 방식**
1. 메모리에 여러 프로세스가 올라오고
2. **시분할 처리**를 통해 각각의 프로세스 짧은 시간동안 교대로 처리

### 📌 PCB
운영체제는 여러 개의 프로세스를 전부 관리하고 공평하게 실행해야 한다.
프로세스 관리는 **PCB(Proccess Control Block)** 를 생성하여 연결리스트의 자료구조로 관리한다. 프로세스 종료 시에는 연결리스트에서 해당 PCB를 제거한다.

#### ✅ PCB 구조
1. **포인터**: 부모, 자식 프로세스에 대한 포인터를 저장
   - 프로세스 계층 구조 파악 및 프로세스 종료 시, 프로세스 상태 추적 가능
2. **프로세스 상태**: 현재 어떤 상태에 있는지 나타내는 정보 (생성, 준비, 실행, 대기, 완료) 
3. **프로세스 ID**: 프로세스 식별자 저장
   - 프로세스는 고유한 PID를 가짐
   - 프로세스 구분하는데 사용되며 시스템 내에 유일해야 함
4. **프로그램 카운터**: 다음에 실행될 명령어의 주소를 저장
   - 현재 실행 중인 명령어의 다음 주소를 저장
   - Context Switch가 발생하면, 해당 프로세스가 진행해야 할 명령어의 주소로 복구
5. **레지스터 정보**: 프로세스가 실행될 때 사용된 레저스터 정보
   - 프로세스 중단, 전환 시, PCB에 레지스터 값 저장한 후, 다시 실행될 때 복구
6. **메모리 관련 정보**: 프로세스가 메모리에 저장된 위치 정보
   - 프로세스가 사용하는 메모리 영역(코드, 데이터, 스택, 힙,,)과 주소를 관리
   - 가상 메모리 시스템에서 중요 - 프로세스 간 메모리 영역 분리
7. **CPU 스케줄링 정보**: 우선순위, 최종 실행시간, 점유 시간 등 CPU를 얼마나 효율적으로 사용할 지에 대한 정보
8. **I/O 상태 정보** : 프로세스가 현재 어떤 입출력 작업을 수행 중인지에 대한 정보
9. **열린 파일 목록(Open File List)** : 현재 열고 있는 파일들의 목록 관리

### 📌 프로세스 상태

1. **생성 (New)**: 메모리에 프로그램 적재 요청
   - PCB 생성
2. **준비 (Ready)**: CPU 자원 할당을 위해 기다리는 상태
3. **대기 (Waiting)**: 입출력 요청 시, 입출력이 완료될 때까지 대기하는 상태
   - 입출력 완료까지 CPU 대기는 비효율적
   - 입출력을 기다리는 것은 대기 상태로 두고 CPU는 다른 작업 (시스템 자원 낭비 최소화)
   - 입출력이 완료되면 **준비** 상태로 전환
4. **실행 (Running)**: 스케쥴러에 의해 CPU를 할당받아, 부여된 시간만큼 실행되는 상태
   - CPU 개수만큼 실행 프로세스가 생성
   - 부여된 시간을 초과하면 CPU를 강제로 빼앗으며 **준비** 상태로 전환.
   - 실행 도중, 입출력 요청을 하면 다시 **준비** 상태로 전환
5. **완료 (Terminated)**: 프로세스 종료
   - 메모리에서 데이터 제거 및 PCB 제거
### 📌 컨텍스트 스위칭

출처: [그림으로 쉽게 배우는 운영체제](https://www.inflearn.com/course/%EB%B9%84%EC%A0%84%EA%B3%B5%EC%9E%90-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/dashboard)